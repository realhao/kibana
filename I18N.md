# 基于Kibana 6.1.3的翻译说明

### 阶段一

#### 翻译了哪些地方

##### 时间/数字/货币
todo...

##### UI
###### 服务端渲染模板
jade动态模板，例如`#{i18n('UI-WELCOME_MESSAGE')}`

###### Angular内翻译：
```javascript
// in directive,controller,services...
$translate.instant('abc')

// in template
{'KKEYNAME' | translate}

// in template use ng-options
`<select
  ng-model="relative.from.unit"
  ng-options="opt.value as opt.text | translate for opt in relativeOptions"
  ng-change="formatRelative({key:'from'})"
  ng-class="{ 'kuiSelect-isInvalid': checkRelative() }"
  class="kuiSelect fullWidth"></select>`

// in template use ng-pluralize
`<ng-pluralize
  count="hits"
  when="{'1':'{{&quot;HIT&quot; | translate}}', 'other':'{{&quot;HITS&quot; | translate}}'}"></ng-pluralize>`

// in template use ng-bind
`<a class="kuiLink"
  ng-click="setQuick({from: option.from, to: option.to})"
  ng-bind="::option.display | translate"
  kbn-accessible-click></a>`

// varable replacement
"AUTOREFRESHTIP": "Data will refresh every {{refreshInterval}}"
$scope.translateFn = $translate.instant;
`<span ng-show="timefilter.refreshInterval.value > 0"
      aria-label="{{ 'TIMEPICKER.AUTOREFRESHTIP' | translate:{refreshInterval:translateFn(timefilter.refreshInterval.display)} }}">`

// translate html content
`<span
  class="kbn-timepicker-action-item kbn-timepicker-error"
  ng-show="checkRelative()"
  ng-bind-html="'TIMEPICKER.FROMBEFORETONOTE' | translate | trusted"></span>`
```

###### React Componet里翻译
因为目前看到的都是Angular通过ngReact调用组件，所以组件的翻译，主要涉及：
1. 直接被Angular调用的组件，上下文里用Angular场景的翻译
2. react子组件的翻译，把Angular的翻译方法通过属性绑定给到react，供子组件调用时翻译。
```javascript
// angular
$scope.t = chrome.getReactTranslateFun($translate.instant);
// angular tmplate
<react-component-app t="t">
// react
{t('KEY')}
```

#### 还需要注意的部分

1. 默认语言设置为**en**，可以保证翻译文件未覆盖到的部分都是英文状态。
2. 在未找到key对应的翻译值时，会返回key
	- 2.1 动态数据的翻译可直接把内容作为key，只要其中不含`.`就可以，因为`.`会被当做命名空间的分隔符使用。在*任何ui还未mixn*的情况下，如服务端的某些配置需要翻译，同样适用。
	- 2.2 不要使用未定义的key，至少保证有一种语言会被命中，最好是英文。
3. 某些单测用例是关联内容文字的，可能会失败:confused:

> 例如：
> `"Discover": "日志检索"`
> `"Hello Foo!": "你好，Foo!"`


#### 参考
1. [kibana官方issue的记录](https://github.com/elastic/kibana/issues/6515)
2. [源码里关于翻译的说明](/docs/development/plugin/development-internationalization.asciidoc)
3. [angular i18n and i10n](https://docs.angularjs.org/guide/i18n)
4. [angular-translate docs](https://angular-translate.github.io/docs)
5. [icu project](http://userguide.icu-project.org/i18n)
